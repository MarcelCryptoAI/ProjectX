<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A.R.I.E - AI Trading Bot Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.29.1.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'neon-cyan': '#00D9FF',
                        'neon-yellow': '#FFD700',
                        'neon-pink': '#CC0000',
                        'neon-green': '#008844',
                        'neon-orange': '#FF6B00',
                        'matrix-green': '#00FF41',
                        'dark-bg': '#0A0A0F',
                        'dark-panel': '#0F0F1A',
                        'dark-border': '#1A1A2E',
                        'dark-hover': '#16213E'
                    },
                    fontFamily: {
                        'sans': ['Inter', 'Segoe UI', 'system-ui', 'sans-serif'],
                        'mono': ['SF Mono', 'Consolas', 'monospace']
                    },
                    animation: {
                        'pulse-neon': 'pulse-neon 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                        'float': 'float 6s ease-in-out infinite',
                        'matrix': 'matrix 20s linear infinite'
                    },
                    backdropBlur: {
                        xs: '2px',
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500;700&family=Fira+Code:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        @keyframes pulse-neon {
            0%, 100% { opacity: 1; filter: brightness(1) drop-shadow(0 0 20px currentColor); }
            50% { opacity: 0.8; filter: brightness(1.2) drop-shadow(0 0 40px currentColor); }
        }
        @keyframes glow {
            from { text-shadow: 0 0 10px currentColor, 0 0 20px currentColor; }
            to { text-shadow: 0 0 20px currentColor, 0 0 30px currentColor, 0 0 40px currentColor; }
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            33% { transform: translateY(-10px) rotate(1deg); }
            66% { transform: translateY(5px) rotate(-1deg); }
        }
        @keyframes matrix {
            0% { transform: translateY(0); }
            100% { transform: translateY(100%); }
        }
        
        body {
            background: #0A0A0F;
            position: relative;
            overflow-x: hidden;
        }
        
        /* Removed animated background lines */
        
        
        .glass-panel {
            background: rgba(15, 15, 26, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 217, 255, 0.2);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                0 0 40px rgba(0, 217, 255, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .glass-panel::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 30%,
                rgba(0, 217, 255, 0.1) 50%,
                transparent 70%
            );
            transform: rotate(45deg);
            transition: all 0.5s;
            opacity: 0;
        }
        
        .glass-panel:hover::before {
            opacity: 1;
            animation: float 3s ease-in-out infinite;
        }
        
        .neon-text {
            text-shadow: 0 0 10px currentColor, 0 0 20px currentColor, 0 0 30px currentColor;
            letter-spacing: 0.05em;
        }
        
        .neon-border {
            position: relative;
            border: 2px solid transparent;
            background: linear-gradient(#0F0F1A, #0F0F1A) padding-box,
                        linear-gradient(45deg, #FFD700, #FFED4E, #FFA500, #FFD700) border-box;
        }
        
        .neon-border::after {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #FFD700, #FFED4E, #FFA500, #FFD700);
            z-index: -1;
            filter: blur(10px);
            opacity: 0.5;
            animation: float 4s ease-in-out infinite;
        }
        
        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
            opacity: 0.05;
        }
        
        .matrix-bg::before {
            content: '101010110101001010101101010010101011010100101010110101001010101101010010101011010100';
            position: absolute;
            top: -100%;
            left: 0;
            width: 100%;
            height: 200%;
            color: #00FF41;
            font-family: 'Fira Code', monospace;
            font-size: 20px;
            line-height: 1.2;
            animation: matrix 20s linear infinite;
            word-break: break-all;
        }
        
        .cyber-button {
            position: relative;
            background: linear-gradient(135deg, rgba(0, 217, 255, 0.1), rgba(161, 0, 255, 0.1));
            border: 1px solid rgba(0, 217, 255, 0.5);
            color: #00D9FF;
            font-family: 'Orbitron', sans-serif;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            transition: all 0.3s;
            overflow: hidden;
        }
        
        .cyber-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(0, 217, 255, 0.5), transparent);
            transform: translate(-50%, -50%);
            transition: width 0.5s, height 0.5s;
        }
        
        .cyber-button:hover {
            background: linear-gradient(135deg, rgba(0, 217, 255, 0.2), rgba(161, 0, 255, 0.2));
            border-color: #00D9FF;
            box-shadow: 0 0 20px rgba(0, 217, 255, 0.5), inset 0 0 20px rgba(0, 217, 255, 0.1);
            transform: translateY(-2px);
        }
        
        .cyber-button:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .cyber-button:active {
            transform: translateY(0);
        }
        
        .performance-period-active {
            background: linear-gradient(135deg, rgba(0, 217, 255, 0.3), rgba(161, 0, 255, 0.3));
            border-color: #00D9FF;
            box-shadow: 0 0 15px rgba(0, 217, 255, 0.4);
        }
        
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            position: relative;
        }
        
        .status-indicator.online {
            background: #008844;
            box-shadow: 0 0 10px #008844, 0 0 20px #008844;
        }
        
        .status-indicator.offline {
            background: #CC0000;
            box-shadow: 0 0 10px #CC0000, 0 0 20px #CC0000;
        }
        
        .status-indicator.processing {
            background: #FFD700;
            box-shadow: 0 0 10px #FFD700, 0 0 20px #FFD700;
            animation: pulse-neon 1s infinite;
        }
        
        .profit-text { color: #008844; text-shadow: 0 0 10px #008844; }
        .loss-text { color: #CC0000; text-shadow: 0 0 10px #CC0000; }
        
        .chart-container {
            position: relative;
            height: 400px;
            background: rgba(10, 10, 15, 0.8);
            border: 1px solid rgba(0, 217, 255, 0.2);
            border-radius: 8px;
            padding: 20px;
        }
        
        .trading-view-widget {
            background: rgba(15, 15, 26, 0.9);
            border: 1px solid rgba(0, 217, 255, 0.3);
            border-radius: 8px;
            overflow: hidden;
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, #00D9FF, #A100FF);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, #00D9FF, #CC0000);
        }
    </style>
</head>
<body class="bg-dark-bg text-white font-sans min-h-screen relative">
    <!-- Matrix Background -->
    <div class="matrix-bg"></div>
    
    
    <!-- Include shared header -->
    {% include 'includes/header.html' %}

    <div class="flex min-h-screen relative z-10">
        <!-- AI Control Sidebar -->
        <div class="w-96 bg-gradient-to-b from-dark-panel to-dark-bg p-6 border-r border-dark-border">
            <div class="space-y-6">
                <!-- Neural Control Center -->
                <div class="glass-panel rounded-xl p-6 neon-border">
                    <h3 class="text-2xl font-bold text-neon-cyan mb-6 flex items-center animate-glow">
                        <i class="fas fa-robot mr-3"></i> A.R.I.E CONTROL CENTER
                    </h3>
                    
                    <!-- System Status -->
                    <div class="mb-6 p-4 bg-dark-bg/50 rounded-lg border border-neon-cyan/20">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-gray-400 text-sm">SYSTEM STATUS</span>
                            <span id="systemStatus" class="flex items-center">
                                <span class="status-indicator offline" id="statusDot"></span>
                                <span class="text-sm font-medium" id="statusText">OFFLINE</span>
                            </span>
                        </div>
                        <div class="grid grid-cols-2 gap-3 text-xs">
                            <div>
                                <span class="text-gray-500">API:</span>
                                <span id="apiStatus" class="ml-1 text-neon-green">CONNECTED</span>
                            </div>
                            <div>
                                <span class="text-gray-500">AI:</span>
                                <span id="aiStatus" class="ml-1 text-neon-yellow">TRAINING</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Control Buttons -->
                    <div class="space-y-4">
                        <button class="w-full cyber-button py-4 px-6 rounded-lg flex items-center justify-center group bg-dark-bg/50" onclick="startBot()" id="startBtn" style="border-color: #008844; color: #008844;">
                            <i class="fas fa-play mr-3 text-lg group-hover:animate-pulse"></i>
                            <span class="font-bold text-lg">START BOT</span>
                        </button>
                        
                        <button class="w-full cyber-button py-4 px-6 rounded-lg flex items-center justify-center group bg-dark-bg/50" onclick="stopBot()" id="stopBtn" style="border-color: #CC0000; color: #CC0000;">
                            <i class="fas fa-stop mr-3 text-lg group-hover:animate-pulse"></i>
                            <span class="font-bold text-lg">STOP BOT</span>
                        </button>
                        
                        <div class="mt-4 p-3 bg-dark-bg/50 rounded-lg border border-neon-yellow/30">
                            <div class="text-xs text-neon-yellow text-center">
                                <i class="fas fa-info-circle mr-1"></i>
                                START: Trains AI + Starts Live Trading<br>
                                STOP: Stops all trading activities
                            </div>
                        </div>
                    </div>
                    
                    <!-- Trading Parameters -->
                    <div class="mt-6 p-4 bg-dark-bg/50 rounded-lg border border-neon-yellow/20">
                        <h4 class="text-sm font-bold text-neon-yellow mb-3">TRADING PARAMETERS</h4>
                        <div class="space-y-2 text-xs">
                            <div class="flex justify-between">
                                <span class="text-gray-400">Strategy Mode:</span>
                                <span class="text-neon-yellow" id="strategyMode">BALANCED</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Max Positions:</span>
                                <span class="text-neon-yellow" id="maxPositions">20</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">AI Confidence:</span>
                                <span class="text-neon-yellow" id="aiConfidence">95%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Min Accuracy:</span>
                                <span class="text-neon-yellow" id="minAccuracy">88%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Amount per Trade:</span>
                                <span class="text-neon-yellow" id="amountPerTrade">$100</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Leverage:</span>
                                <span class="text-neon-yellow" id="leverage">10x</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Dynamic TP:</span>
                                <span class="text-neon-yellow" id="dynamicTP">OFF</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Trailing SL:</span>
                                <span class="text-neon-yellow" id="trailingSL">OFF</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Trailing %:</span>
                                <span class="text-neon-yellow" id="trailingPercent">2%</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Training Progress -->
                <div class="glass-panel rounded-xl p-6" id="trainingProgressPanel" style="display: none;">
                    <h4 class="text-lg font-bold text-neon-yellow mb-4 flex items-center">
                        <i class="fas fa-brain mr-2 animate-pulse"></i> AI TRAINING
                    </h4>
                    <div class="space-y-3">
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span>Progress</span>
                                <span id="trainingPercent">0%</span>
                            </div>
                            <div class="w-full bg-dark-bg rounded-full h-3 overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-neon-yellow to-neon-orange transition-all duration-500" 
                                     style="width: 0%" id="trainingProgressBar"></div>
                            </div>
                        </div>
                        <div class="text-xs text-gray-400">
                            <div>Symbol: <span id="currentSymbol" class="text-neon-cyan">-</span></div>
                            <div>Batch: <span id="currentBatch" class="text-neon-yellow">0/0</span></div>
                        </div>
                    </div>
                </div>
                
                <!-- Activity Log -->
                <div class="glass-panel rounded-xl p-6">
                    <h4 class="text-lg font-bold text-neon-green mb-4 flex items-center">
                        <i class="fas fa-terminal mr-2"></i> SYSTEM LOG
                    </h4>
                    <div class="h-64 overflow-y-auto bg-dark-bg/50 rounded-lg p-3 font-mono text-xs" id="consoleOutput">
                        <div class="text-neon-green">System initialized...</div>
                        <div class="text-gray-400">Waiting for commands...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="flex-1 p-8">
            <!-- Top Stats Grid -->
            <div class="grid grid-cols-4 gap-6 mb-8">
                <!-- Total Balance -->
                <div class="glass-panel rounded-xl p-6 hover:scale-105 transition-transform">
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="text-sm font-medium text-gray-400">TOTAL BALANCE</h4>
                        <i class="fas fa-wallet text-neon-cyan text-xl"></i>
                    </div>
                    <div class="text-3xl font-bold font-bold text-white" id="totalBalance">$0.00</div>
                    <div class="text-sm mt-2 text-gray-500">USDT</div>
                </div>
                
                <!-- Active Positions -->
                <div class="glass-panel rounded-xl p-6 hover:scale-105 transition-transform">
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="text-sm font-medium text-gray-400">ACTIVE POSITIONS</h4>
                        <i class="fas fa-chart-line text-neon-yellow text-xl"></i>
                    </div>
                    <div class="text-3xl font-bold font-bold text-white" id="activePositions">0</div>
                    <div class="text-sm mt-2 text-gray-500">TRADES</div>
                </div>
                
                <!-- P&L Stats -->
                <div class="glass-panel rounded-xl p-6 hover:scale-105 transition-transform">
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="text-sm font-medium text-gray-400">P&L OVERVIEW</h4>
                        <i class="fas fa-chart-area text-neon-yellow text-xl"></i>
                    </div>
                    <div class="space-y-2">
                        <!-- Unrealized P&L -->
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-500">Unrealized:</span>
                            <span class="text-lg font-bold" id="unrealizedPnL">
                                <span class="profit-text">+$0.00</span>
                            </span>
                        </div>
                        <!-- Realized P&L 24h -->
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-500">24h Realized:</span>
                            <span class="text-lg font-bold" id="realizedPnL24h">
                                <span class="profit-text">+$0.00</span>
                            </span>
                        </div>
                        <!-- Realized P&L All-time -->
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-500">All-time Realized:</span>
                            <span class="text-lg font-bold" id="realizedPnLAllTime">
                                <span class="profit-text">+$0.00</span>
                            </span>
                        </div>
                    </div>
                </div>
                
                <!-- Win Rate -->
                <div class="glass-panel rounded-xl p-6 hover:scale-105 transition-transform">
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="text-sm font-medium text-gray-400">WIN RATE</h4>
                        <i class="fas fa-trophy text-neon-yellow text-xl"></i>
                    </div>
                    <div class="text-3xl font-bold font-bold text-white" id="winRate">0%</div>
                    <div class="text-sm mt-2 text-gray-500" id="totalTrades">0 TRADES</div>
                </div>
            </div>
            
            <!-- Open Positions -->
            <div class="glass-panel rounded-xl p-6 mb-8">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold font-bold text-white flex items-center">
                        <i class="fas fa-rocket mr-3 text-neon-cyan animate-pulse"></i>
                        ACTIVE POSITIONS
                    </h3>
                    <button class="cyber-button py-2 px-4 rounded-lg text-sm" onclick="closeAllPositions()">
                        <i class="fas fa-times-circle mr-2"></i> CLOSE ALL
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full min-w-max" id="activePositionsTable">
                        <thead>
                            <tr class="border-b border-dark-border text-left">
                                <th class="pb-3 text-gray-400 font-medium cursor-pointer hover:text-neon-cyan transition-colors" onclick="sortTable('symbol')">
                                    Symbol
                                    <i class="fas fa-sort ml-1 text-xs" id="sort-icon-symbol"></i>
                                </th>
                                <th class="pb-3 text-gray-400 font-medium cursor-pointer hover:text-neon-cyan transition-colors" onclick="sortTable('side')">
                                    Side
                                    <i class="fas fa-sort ml-1 text-xs" id="sort-icon-side"></i>
                                </th>
                                <th class="pb-3 text-gray-400 font-medium cursor-pointer hover:text-neon-cyan transition-colors" onclick="sortTable('size')">
                                    Size
                                    <i class="fas fa-sort ml-1 text-xs" id="sort-icon-size"></i>
                                </th>
                                <th class="pb-3 text-gray-400 font-medium cursor-pointer hover:text-neon-cyan transition-colors" onclick="sortTable('entry')">
                                    Entry
                                    <i class="fas fa-sort ml-1 text-xs" id="sort-icon-entry"></i>
                                </th>
                                <th class="pb-3 text-gray-400 font-medium cursor-pointer hover:text-neon-cyan transition-colors" onclick="sortTable('current')">
                                    Current
                                    <i class="fas fa-sort ml-1 text-xs" id="sort-icon-current"></i>
                                </th>
                                <th class="pb-3 text-gray-400 font-medium cursor-pointer hover:text-neon-cyan transition-colors" onclick="sortTable('pnl')">
                                    P&L
                                    <i class="fas fa-sort ml-1 text-xs" id="sort-icon-pnl"></i>
                                </th>
                                <th class="pb-3 text-gray-400 font-medium cursor-pointer hover:text-neon-cyan transition-colors" onclick="sortTable('roi')">
                                    ROI
                                    <i class="fas fa-sort ml-1 text-xs" id="sort-icon-roi"></i>
                                </th>
                                <th class="pb-3 text-gray-400 font-medium cursor-pointer hover:text-neon-cyan transition-colors" onclick="sortTable('leverage')">
                                    Leverage
                                    <i class="fas fa-sort ml-1 text-xs" id="sort-icon-leverage"></i>
                                </th>
                                <th class="pb-3 text-gray-400 font-medium cursor-pointer hover:text-neon-cyan transition-colors" onclick="sortTable('im')">
                                    IM
                                    <i class="fas fa-sort ml-1 text-xs" id="sort-icon-im"></i>
                                </th>
                                <th class="pb-3 text-gray-400 font-medium cursor-pointer hover:text-neon-cyan transition-colors" onclick="sortTable('mm')">
                                    MM
                                    <i class="fas fa-sort ml-1 text-xs" id="sort-icon-mm"></i>
                                </th>
                                <th class="pb-3 text-gray-400 font-medium cursor-pointer hover:text-neon-cyan transition-colors text-xs" onclick="sortTable('tp1')">
                                    TP1
                                    <i class="fas fa-sort ml-1 text-xs" id="sort-icon-tp1"></i>
                                </th>
                                <th class="pb-3 text-gray-400 font-medium cursor-pointer hover:text-neon-cyan transition-colors text-xs" onclick="sortTable('tp2')">
                                    TP2
                                    <i class="fas fa-sort ml-1 text-xs" id="sort-icon-tp2"></i>
                                </th>
                                <th class="pb-3 text-gray-400 font-medium cursor-pointer hover:text-neon-cyan transition-colors text-xs" onclick="sortTable('tp3')">
                                    TP3
                                    <i class="fas fa-sort ml-1 text-xs" id="sort-icon-tp3"></i>
                                </th>
                                <th class="pb-3 text-gray-400 font-medium cursor-pointer hover:text-neon-cyan transition-colors text-xs" onclick="sortTable('tp4')">
                                    TP4
                                    <i class="fas fa-sort ml-1 text-xs" id="sort-icon-tp4"></i>
                                </th>
                                <th class="pb-3 text-gray-400 font-medium cursor-pointer hover:text-neon-cyan transition-colors text-xs" onclick="sortTable('stop_loss')">
                                    SL
                                    <i class="fas fa-sort ml-1 text-xs" id="sort-icon-stop_loss"></i>
                                </th>
                                <th class="pb-3 text-gray-400 font-medium cursor-pointer hover:text-neon-cyan transition-colors text-xs" onclick="sortTable('sl_breakeven')">
                                    SL@BE
                                    <i class="fas fa-sort ml-1 text-xs" id="sort-icon-sl_breakeven"></i>
                                </th>
                                <th class="pb-3 text-gray-400 font-medium">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="positionsTable">
                            <tr>
                                <td colspan="17" class="text-center py-8 text-gray-500">
                                    No active positions
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Charts Row -->
            <div class="grid grid-cols-2 gap-6 mb-8">
                <!-- ROI Chart -->
                <div class="glass-panel rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold font-bold text-white">CUMULATIVE ROI</h3>
                        <div class="flex space-x-2">
                            <button class="cyber-button py-1 px-3 rounded text-xs active" onclick="changeROIPeriod('1h', this)">1H</button>
                            <button class="cyber-button py-1 px-3 rounded text-xs" onclick="changeROIPeriod('4h', this)">4H</button>
                            <button class="cyber-button py-1 px-3 rounded text-xs" onclick="changeROIPeriod('12h', this)">12H</button>
                            <button class="cyber-button py-1 px-3 rounded text-xs" onclick="changeROIPeriod('1d', this)">1D</button>
                            <button class="cyber-button py-1 px-3 rounded text-xs" onclick="changeROIPeriod('3d', this)">3D</button>
                            <button class="cyber-button py-1 px-3 rounded text-xs" onclick="changeROIPeriod('7d', this)">7D</button>
                            <button class="cyber-button py-1 px-3 rounded text-xs" onclick="changeROIPeriod('30d', this)">30D</button>
                            <button class="cyber-button py-1 px-3 rounded text-xs" onclick="changeROIPeriod('3m', this)">3M</button>
                            <button class="cyber-button py-1 px-3 rounded text-xs" onclick="changeROIPeriod('1y', this)">1Y</button>
                            <button class="cyber-button py-1 px-3 rounded text-xs" onclick="changeROIPeriod('all', this)">ALL</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="roiChart"></canvas>
                    </div>
                </div>
                
                <!-- Performance Analytics -->
                <div class="glass-panel rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold font-bold text-white">PERFORMANCE ANALYTICS</h3>
                        <div class="flex space-x-2">
                            <button class="cyber-button py-1 px-3 rounded text-xs performance-period-active" onclick="changePerformancePeriod('1h', this)">1H</button>
                            <button class="cyber-button py-1 px-3 rounded text-xs" onclick="changePerformancePeriod('4h', this)">4H</button>
                            <button class="cyber-button py-1 px-3 rounded text-xs" onclick="changePerformancePeriod('12h', this)">12H</button>
                            <button class="cyber-button py-1 px-3 rounded text-xs" onclick="changePerformancePeriod('1d', this)">1D</button>
                            <button class="cyber-button py-1 px-3 rounded text-xs" onclick="changePerformancePeriod('3d', this)">3D</button>
                            <button class="cyber-button py-1 px-3 rounded text-xs" onclick="changePerformancePeriod('7d', this)">7D</button>
                            <button class="cyber-button py-1 px-3 rounded text-xs" onclick="changePerformancePeriod('30d', this)">30D</button>
                            <button class="cyber-button py-1 px-3 rounded text-xs" onclick="changePerformancePeriod('3m', this)">3M</button>
                            <button class="cyber-button py-1 px-3 rounded text-xs" onclick="changePerformancePeriod('1y', this)">1Y</button>
                            <button class="cyber-button py-1 px-3 rounded text-xs" onclick="changePerformancePeriod('all', this)">ALL</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- AI Signals -->
            <div class="glass-panel rounded-xl p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold font-bold text-white flex items-center">
                        <i class="fas fa-robot mr-3 text-neon-yellow"></i>
                        AI TRADING SIGNALS
                    </h3>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-400">Auto-Execute:</span>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" class="sr-only peer" id="autoExecute" onchange="toggleAutoExecute()">
                            <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-neon-green"></div>
                        </label>
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-4" id="signalsGrid">
                    <div class="text-center py-12 text-gray-500 col-span-3">
                        <i class="fas fa-brain text-6xl mb-4 opacity-20"></i>
                        <p>AI is analyzing market conditions...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- WebSocket and JavaScript -->
    <script>
        const socket = io();
        let roiChart, performanceChart;
        let currentROIPeriod = '1h';
        
        // Table sorting variables
        let currentPositions = [];
        let sortColumn = null;
        let sortDirection = 'asc';
        
        // Initialize charts
        function initCharts() {
            // ROI Chart
            const roiCtx = document.getElementById('roiChart').getContext('2d');
            roiChart = new Chart(roiCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Cumulative ROI %',
                        data: [],
                        borderColor: '#00D9FF',
                        backgroundColor: 'rgba(0, 217, 255, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#00D9FF',
                        pointBorderColor: '#00D9FF',
                        pointHoverBackgroundColor: '#CC0000',
                        pointHoverBorderColor: '#CC0000',
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#00D9FF',
                            bodyColor: '#FFFFFF',
                            borderColor: '#00D9FF',
                            borderWidth: 1,
                            cornerRadius: 4,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return `ROI: ${context.parsed.y.toFixed(2)}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)',
                                borderColor: 'rgba(0, 217, 255, 0.3)'
                            },
                            ticks: {
                                color: '#888',
                                font: {
                                    family: 'JetBrains Mono'
                                }
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)',
                                borderColor: 'rgba(0, 217, 255, 0.3)'
                            },
                            ticks: {
                                color: '#888',
                                font: {
                                    family: 'JetBrains Mono'
                                },
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
            
            // Performance Chart
            const perfCtx = document.getElementById('performanceChart').getContext('2d');
            performanceChart = new Chart(perfCtx, {
                type: 'bar',
                data: {
                    labels: ['Wins', 'Losses', 'Pending'],
                    datasets: [{
                        data: [0, 0, 0],
                        backgroundColor: [
                            'rgba(0, 136, 68, 0.5)',
                            'rgba(204, 0, 0, 0.5)',
                            'rgba(255, 215, 0, 0.5)'
                        ],
                        borderColor: [
                            '#008844',
                            '#CC0000',
                            '#FFD700'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#00D9FF',
                            bodyColor: '#FFFFFF',
                            borderColor: '#00D9FF',
                            borderWidth: 1,
                            cornerRadius: 4
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)',
                                borderColor: 'rgba(0, 217, 255, 0.3)'
                            },
                            ticks: {
                                color: '#888',
                                font: {
                                    family: 'Orbitron',
                                    weight: 'bold'
                                }
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)',
                                borderColor: 'rgba(0, 217, 255, 0.3)'
                            },
                            ticks: {
                                color: '#888',
                                font: {
                                    family: 'JetBrains Mono'
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Update dashboard data with real ByBit data
        function updateDashboard() {
            // Get real balance data
            fetch('/api/analytics_data')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Update balance with real data
                        document.getElementById('totalBalance').textContent = `$${data.total_balance.toFixed(2)}`;
                        
                        // Update positions with real data
                        document.getElementById('activePositions').textContent = data.active_positions_count;
                        
                        // Update P&L with real data
                        const unrealizedPnL = data.unrealized_pnl || 0;
                        const realizedPnL24h = data.realized_pnl_24h || 0;
                        const realizedPnLAllTime = data.realized_pnl_all_time || 0;
                        
                        // Update Unrealized P&L
                        const unrealizedElement = document.getElementById('unrealizedPnL');
                        if (unrealizedPnL >= 0) {
                            unrealizedElement.innerHTML = `<span class="profit-text">+$${Math.abs(unrealizedPnL).toFixed(2)}</span>`;
                        } else {
                            unrealizedElement.innerHTML = `<span class="loss-text">-$${Math.abs(unrealizedPnL).toFixed(2)}</span>`;
                        }
                        
                        // Update Realized P&L 24h
                        const realized24hElement = document.getElementById('realizedPnL24h');
                        if (realizedPnL24h >= 0) {
                            realized24hElement.innerHTML = `<span class="profit-text">+$${Math.abs(realizedPnL24h).toFixed(2)}</span>`;
                        } else {
                            realized24hElement.innerHTML = `<span class="loss-text">-$${Math.abs(realizedPnL24h).toFixed(2)}</span>`;
                        }
                        
                        // Update Realized P&L All-time
                        const realizedAllTimeElement = document.getElementById('realizedPnLAllTime');
                        if (realizedPnLAllTime >= 0) {
                            realizedAllTimeElement.innerHTML = `<span class="profit-text">+$${Math.abs(realizedPnLAllTime).toFixed(2)}</span>`;
                        } else {
                            realizedAllTimeElement.innerHTML = `<span class="loss-text">-$${Math.abs(realizedPnLAllTime).toFixed(2)}</span>`;
                        }
                        
                        // Calculate real win rate from trading history
                        const winRate = data.win_rate || 0;
                        const totalTrades = data.total_trades || 0;
                        document.getElementById('winRate').textContent = `${winRate.toFixed(1)}%`;
                        document.getElementById('totalTrades').textContent = `${totalTrades} TRADES`;
                        
                        // Update positions table with real data
                        updatePositionsTable(data.positions || []);
                        
                        // Update performance chart with real data
                        updatePerformanceChart(data);
                    }
                })
                .catch(error => {
                    console.error('Dashboard update error:', error);
                    // Show error state
                    document.getElementById('totalBalance').textContent = 'Error';
                    document.getElementById('activePositions').textContent = '0';
                    document.getElementById('unrealizedPnL').innerHTML = '<span class="text-gray-500">Error</span>';
                    document.getElementById('realizedPnL24h').innerHTML = '<span class="text-gray-500">Error</span>';
                    document.getElementById('realizedPnLAllTime').innerHTML = '<span class="text-gray-500">Error</span>';
                });
                
            // Update trading parameters from settings
            updateTradingParameters();
            
            // Get real trading signals
            fetch('/api/trading_signals')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateTradingSignals(data.signals || []);
                    }
                })
                .catch(error => console.error('Signals update error:', error));
        }
        
        // Helper function to format TP levels
        function formatTPLevel(tpLevels, level, markPrice) {
            if (!tpLevels || tpLevels.length < level) {
                return '<span class="text-gray-500">-</span>';
            }
            
            const tp = tpLevels[level - 1];
            const distance = tp.distance_percent || 0;
            const status = tp.status || 'pending';
            const price = tp.price || 0;
            const isHit = status === 'hit' || status === 'filled';
            
            let colorClass = 'text-gray-400';
            let statusIcon = '';
            let bgClass = '';
            
            if (isHit) {
                colorClass = 'text-green-400';
                statusIcon = '✓ ';
                bgClass = 'bg-green-900/20';
            } else if (distance > 0) {
                colorClass = 'text-neon-yellow';
                bgClass = 'bg-yellow-900/20';
            } else {
                colorClass = 'text-gray-500';
                bgClass = 'bg-gray-900/20';
            }
            
            const tooltip = `TP${level}: $${price.toFixed(4)} (${distance.toFixed(2)}% from current)`;
            
            return `<span class="${colorClass} ${bgClass} px-1 py-0.5 rounded text-xs" title="${tooltip}">
                ${statusIcon}${Math.abs(distance).toFixed(1)}%
            </span>`;
        }
        
        // Helper function to format stop loss
        function formatStopLoss(stopLoss, markPrice) {
            if (!stopLoss || stopLoss === 0) {
                return '<span class="text-gray-500">-</span>';
            }
            
            const slPrice = typeof stopLoss === 'object' ? stopLoss.price : stopLoss;
            if (!slPrice || slPrice === 0) {
                return '<span class="text-gray-500">-</span>';
            }
            
            const price = parseFloat(slPrice);
            const currentPrice = parseFloat(markPrice) || 0;
            
            // Calculate distance percentage
            let distancePercent = 0;
            if (currentPrice > 0) {
                distancePercent = Math.abs((price - currentPrice) / currentPrice * 100);
            }
            
            const tooltip = `Stop Loss: $${price.toFixed(4)} (${distancePercent.toFixed(2)}% from current)`;
            
            return `<span class="text-neon-pink bg-red-900/20 px-1 py-0.5 rounded text-xs" title="${tooltip}">
                $${price.toFixed(4)}
            </span>`;
        }
        
        // Helper function to get TP distance for sorting
        function getTPDistance(tpLevels, level) {
            if (!tpLevels || tpLevels.length < level) {
                return 0;
            }
            
            const tp = tpLevels[level - 1];
            return Math.abs(tp.distance_percent || 0);
        }

        // Update positions table
        function updatePositionsTable(positions) {
            const tbody = document.getElementById('positionsTable');
            
            if (!positions || positions.length === 0) {
                currentPositions = [];
                tbody.innerHTML = `
                    <tr>
                        <td colspan="17" class="text-center py-8 text-gray-500">
                            No active positions
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Store positions for sorting
            currentPositions = positions;
            
            // Apply current sort if any
            if (sortColumn) {
                positions = sortPositions(positions, sortColumn, sortDirection);
            }
            
            tbody.innerHTML = positions.map(pos => {
                const pnl = parseFloat(pos.unrealisedPnl || 0);
                const pnlPercent = parseFloat(pos.percentage || 0);
                const pnlClass = pnl >= 0 ? 'profit-text' : 'loss-text';
                const leverage = parseFloat(pos.leverage || 1);
                const positionIM = parseFloat(pos.positionIM || 0);
                const positionMM = parseFloat(pos.positionMM || 0);
                
                return `
                    <tr class="border-b border-dark-border hover:bg-dark-hover transition-colors">
                        <td class="py-3 font-medium">${pos.symbol}</td>
                        <td class="py-3">
                            <span class="px-2 py-1 rounded text-xs font-bold ${pos.side === 'Buy' ? 'bg-green-900/50 text-green-400' : 'bg-red-900/50 text-red-400'}">
                                ${pos.side}
                            </span>
                        </td>
                        <td class="py-3">${pos.size}</td>
                        <td class="py-3">$${parseFloat(pos.avgPrice).toFixed(4)}</td>
                        <td class="py-3">$${parseFloat(pos.markPrice).toFixed(4)}</td>
                        <td class="py-3 ${pnlClass}">
                            ${pnl >= 0 ? '+' : ''}$${Math.abs(pnl).toFixed(2)}
                        </td>
                        <td class="py-3 ${pnlClass}">
                            ${pnlPercent >= 0 ? '+' : ''}${pnlPercent.toFixed(2)}%
                        </td>
                        <td class="py-3 text-neon-yellow">
                            ${leverage.toFixed(1)}x
                        </td>
                        <td class="py-3 text-gray-300">
                            $${positionIM.toFixed(2)}
                        </td>
                        <td class="py-3 text-gray-300">
                            $${positionMM.toFixed(2)}
                        </td>
                        <td class="py-3 text-center text-xs">
                            ${formatTPLevel(pos.tp_levels, 1, pos.markPrice)}
                        </td>
                        <td class="py-3 text-center text-xs">
                            ${formatTPLevel(pos.tp_levels, 2, pos.markPrice)}
                        </td>
                        <td class="py-3 text-center text-xs">
                            ${formatTPLevel(pos.tp_levels, 3, pos.markPrice)}
                        </td>
                        <td class="py-3 text-center text-xs">
                            ${formatTPLevel(pos.tp_levels, 4, pos.markPrice)}
                        </td>
                        <td class="py-3 text-center text-xs">
                            ${formatStopLoss(pos.stop_loss, pos.markPrice)}
                        </td>
                        <td class="py-3 text-center text-xs">
                            <span class="px-1 py-0.5 rounded text-xs ${pos.sl_moved_to_breakeven ? 'bg-green-900/50 text-green-400' : 'bg-gray-900/50 text-gray-400'}">
                                ${pos.sl_moved_to_breakeven ? 'YES' : 'NO'}
                            </span>
                        </td>
                        <td class="py-3">
                            <button class="cyber-button py-1 px-3 rounded text-xs" onclick="closePosition('${pos.symbol}', '${pos.side}', '${pos.size}')">
                                Close
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // Update trading status
        function updateTradingStatus() {
            fetch('/api/trading_status')
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.status) {
                        const statusDot = document.getElementById('statusDot');
                        const statusText = document.getElementById('statusText');
                        
                        if (data.status.worker_running) {
                            statusDot.className = 'status-indicator online';
                            statusText.textContent = 'ONLINE';
                            statusText.className = 'text-sm font-medium text-neon-green';
                            
                            // Start the worker if not already running
                            if (!data.status.enabled) {
                                fetch('/api/start_worker', { method: 'POST' })
                                    .then(response => response.json())
                                    .then(result => {
                                        if (result.success) {
                                            addConsoleMessage('SUCCESS', 'AI Worker activated');
                                        }
                                    });
                            }
                        } else {
                            statusDot.className = 'status-indicator offline';
                            statusText.textContent = 'OFFLINE';
                            statusText.className = 'text-sm font-medium text-neon-pink';
                        }
                        
                        document.getElementById('maxPositions').textContent = data.status.max_trades || data.status.maxConcurrentTrades || 20;
                    }
                })
                .catch(error => console.error('Trading status error:', error));
        }
        
        // Socket event handlers
        socket.on('console_log', function(data) {
            addConsoleMessage(data.level, data.message);
        });
        
        socket.on('training_progress', function(data) {
            updateTrainingProgress(data.progress);
        });
        
        socket.on('training_log', function(data) {
            addConsoleMessage(data.level, data.message);
        });
        
        socket.on('position_update', function(data) {
            updateDashboard();
        });
        
        // Console message handler
        function addConsoleMessage(level, message) {
            const consoleOutput = document.getElementById('consoleOutput');
            const timestamp = new Date().toLocaleTimeString();
            
            let colorClass = 'text-gray-400';
            let prefix = '>';
            
            switch(level) {
                case 'SUCCESS':
                    colorClass = 'text-neon-green';
                    prefix = '✓';
                    break;
                case 'ERROR':
                    colorClass = 'text-neon-pink';
                    prefix = '✗';
                    break;
                case 'WARNING':
                    colorClass = 'text-neon-yellow';
                    prefix = '!';
                    break;
                case 'INFO':
                    colorClass = 'text-neon-cyan';
                    prefix = 'i';
                    break;
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = colorClass;
            messageDiv.innerHTML = `<span class="text-gray-600">[${timestamp}]</span> <span class="font-bold">${prefix}</span> ${message}`;
            
            consoleOutput.appendChild(messageDiv);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
            
            // Keep only last 100 messages
            while (consoleOutput.children.length > 100) {
                consoleOutput.removeChild(consoleOutput.firstChild);
            }
        }
        
        // Training progress handler
        function updateTrainingProgress(progress) {
            const panel = document.getElementById('trainingProgressPanel');
            panel.style.display = 'block';
            
            document.getElementById('trainingPercent').textContent = `${progress.overall_progress.toFixed(1)}%`;
            document.getElementById('trainingProgressBar').style.width = `${progress.overall_progress}%`;
            document.getElementById('currentSymbol').textContent = progress.current_symbol || '-';
            document.getElementById('currentBatch').textContent = `${progress.current_batch}/${progress.total_batches}`;
            
            if (progress.overall_progress >= 100) {
                setTimeout(() => {
                    panel.style.display = 'none';
                }, 5000);
            }
        }
        
        // Simplified Control functions
        function startBot() {
            addConsoleMessage('INFO', 'Starting A.R.I.E trading bot...');
            
            // Disable button while starting
            const startBtn = document.getElementById('startBtn');
            startBtn.disabled = true;
            startBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-3"></i><span class="font-bold text-lg">STARTING...</span>';
            
            // First start training
            fetch('/api/start_training', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        addConsoleMessage('SUCCESS', 'AI training started - analyzing market data');
                        
                        // Then enable live trading
                        return fetch('/api/enable_trading', { method: 'POST' });
                    } else {
                        throw new Error(data.message || 'Failed to start training');
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        addConsoleMessage('SUCCESS', '🚀 BOT STARTED - Live trading enabled with real money');
                        addConsoleMessage('WARNING', '⚠️ REAL MONEY MODE ACTIVE - Monitor positions carefully');
                    } else {
                        addConsoleMessage('ERROR', data.message || 'Failed to enable trading');
                    }
                })
                .catch(error => {
                    addConsoleMessage('ERROR', `Bot startup failed: ${error.message}`);
                })
                .finally(() => {
                    // Re-enable button
                    startBtn.disabled = false;
                    startBtn.innerHTML = '<i class="fas fa-play mr-3 text-lg group-hover:animate-pulse"></i><span class="font-bold text-lg">START BOT</span>';
                    updateTradingStatus();
                });
        }
        
        function stopBot() {
            addConsoleMessage('WARNING', 'Stopping A.R.I.E trading bot...');
            
            // Disable button while stopping
            const stopBtn = document.getElementById('stopBtn');
            stopBtn.disabled = true;
            stopBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-3"></i><span class="font-bold text-lg">STOPPING...</span>';
            
            fetch('/api/stop_all', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        addConsoleMessage('SUCCESS', '🛑 BOT STOPPED - All trading activities halted');
                        addConsoleMessage('INFO', 'Existing positions remain open - close manually if needed');
                    } else {
                        addConsoleMessage('ERROR', data.message || 'Failed to stop bot');
                    }
                })
                .catch(error => {
                    addConsoleMessage('ERROR', `Bot shutdown failed: ${error.message}`);
                })
                .finally(() => {
                    // Re-enable button
                    stopBtn.disabled = false;
                    stopBtn.innerHTML = '<i class="fas fa-stop mr-3 text-lg group-hover:animate-pulse"></i><span class="font-bold text-lg">STOP BOT</span>';
                    updateTradingStatus();
                });
        }
        
        // Performance period change
        let currentPerformancePeriod = '1h';
        
        function changePerformancePeriod(period, button) {
            currentPerformancePeriod = period;
            
            // Update button states
            button.parentElement.querySelectorAll('.cyber-button').forEach(btn => {
                btn.classList.remove('performance-period-active');
            });
            button.classList.add('performance-period-active');
            
            // Update chart data
            updatePerformanceChart({}, period);
        }
        
        // ROI period change
        function changeROIPeriod(period, button) {
            currentROIPeriod = period;
            
            // Update button states
            button.parentElement.querySelectorAll('.cyber-button').forEach(btn => {
                btn.classList.remove('active');
            });
            button.classList.add('active');
            
            // Update chart data
            updateROIChart(period);
        }
        
        function updateROIChart(period) {
            // Fetch cumulative ROI data from the new API endpoint
            fetch(`/api/cumulative_roi?period=${period}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.roi_data) {
                        const labels = data.roi_data.map(item => {
                            const date = new Date(item.date);
                            if (period === '1h' || period === '4h' || period === '12h') {
                                return date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                            } else if (period === '1d' || period === '3d') {
                                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: '2-digit' });
                            } else {
                                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                            }
                        });
                        const roiData = data.roi_data.map(item => item.cumulative_roi_percent);
                        
                        roiChart.data.labels = labels;
                        roiChart.data.datasets[0].data = roiData;
                        roiChart.update();
                    } else {
                        // Show starting from July 9th with 0 ROI
                        const july9 = new Date('2024-07-09');
                        const today = new Date();
                        const labels = [];
                        const roiData = [];
                        
                        // Create data points from July 9th to today
                        let currentDate = new Date(july9);
                        while (currentDate <= today) {
                            labels.push(currentDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                            roiData.push(0);
                            currentDate.setDate(currentDate.getDate() + 1);
                        }
                        
                        roiChart.data.labels = labels;
                        roiChart.data.datasets[0].data = roiData;
                        roiChart.update();
                    }
                })
                .catch(error => {
                    console.error('ROI chart error:', error);
                    // Show error state starting from July 9th
                    const july9 = new Date('2024-07-09');
                    const today = new Date();
                    const labels = [];
                    const roiData = [];
                    
                    // Create data points from July 9th to today
                    let currentDate = new Date(july9);
                    while (currentDate <= today) {
                        labels.push(currentDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                        roiData.push(0);
                        currentDate.setDate(currentDate.getDate() + 1);
                    }
                    
                    roiChart.data.labels = labels;
                    roiChart.data.datasets[0].data = roiData;
                    roiChart.update();
                });
        }
        
        // Update performance chart with real data
        function updatePerformanceChart(data, period = '1h') {
            // Get performance data for the specified period
            fetch(`/api/performance_analytics?period=${period}`)
                .then(response => response.json())
                .then(perfData => {
                    if (perfData.success) {
                        // Use real data from the API
                        const wins = perfData.winning_trades || 0;
                        const losses = perfData.losing_trades || 0;
                        const pending = perfData.pending_trades || 0;
                        
                        performanceChart.data.datasets[0].data = [wins, losses, pending];
                        performanceChart.update();
                    } else {
                        // Fallback to analytics data
                        const wins = data.winning_trades || 0;
                        const losses = data.losing_trades || 0;
                        const pending = data.active_positions_count || 0;
                        
                        performanceChart.data.datasets[0].data = [wins, losses, pending];
                        performanceChart.update();
                    }
                })
                .catch(error => {
                    console.error('Performance chart error:', error);
                    // Fallback to analytics data on error
                    const wins = data.winning_trades || 0;
                    const losses = data.losing_trades || 0;
                    const pending = data.active_positions_count || 0;
                    
                    performanceChart.data.datasets[0].data = [wins, losses, pending];
                    performanceChart.update();
                });
        }
        
        // Update trading parameters from settings
        function updateTradingParameters() {
            // Load all settings from config API
            fetch('/api/config')
                .then(response => response.json())
                .then(data => {
                    if (data && data.success) {
                        // Update max concurrent trades from user settings
                        const maxPositions = data.maxConcurrentTrades || data.max_positions || 20;
                        document.getElementById('maxPositions').textContent = maxPositions;
                        
                        // Update AI confidence threshold
                        const aiConfidence = data.ai_confidence_threshold || 75;
                        document.getElementById('aiConfidence').textContent = `${aiConfidence}%`;
                        
                        // Update risk per trade (amount calculation)
                        const riskPerTrade = data.risk_per_trade || 2.0;
                        document.getElementById('amountPerTrade').textContent = `${riskPerTrade}% of balance`;
                        
                        // Update leverage range
                        const minLeverage = data.min_leverage || 1;
                        const maxLeverage = data.max_leverage || 10;
                        const leverageStrategy = data.leverage_strategy || 'confidence_based';
                        document.getElementById('leverage').textContent = `${minLeverage}x-${maxLeverage}x (${leverageStrategy})`;
                        
                        // Update strategy mode based on actual setting
                        const actualStrategyMode = data.strategy_mode || 'balanced';
                        let displayStrategyMode = actualStrategyMode.toUpperCase();
                        
                        // Special display names for strategy modes
                        switch(actualStrategyMode) {
                            case 'conservative': displayStrategyMode = 'CONSERVATIVE'; break;
                            case 'balanced': displayStrategyMode = 'BALANCED'; break;
                            case 'aggressive': displayStrategyMode = 'AGGRESSIVE'; break;
                            case 'scalping': displayStrategyMode = 'SCALPING'; break;
                            case 'swing': displayStrategyMode = 'SWING TRADING'; break;
                            default: displayStrategyMode = actualStrategyMode.toUpperCase();
                        }
                        
                        document.getElementById('strategyMode').textContent = displayStrategyMode;
                        
                        // Update dynamic TP (always ON for 4-level TP)
                        document.getElementById('dynamicTP').textContent = 'ON (4 levels)';
                        document.getElementById('dynamicTP').className = 'text-neon-green';
                        
                        // Update trailing stop loss (always ON for TP1 breakeven)
                        document.getElementById('trailingSL').textContent = 'ON (TP1 → BE+0.1%)';
                        document.getElementById('trailingSL').className = 'text-neon-green';
                        
                        // Update trailing percentage
                        document.getElementById('trailingPercent').textContent = '0.1%';
                        
                        // Update min accuracy (fixed at 60% for signals)
                        document.getElementById('minAccuracy').textContent = '88%';
                        console.log('Trading parameters updated successfully');
                        
                        // Update AI confidence from settings
                        const confidenceThreshold = data.settings.confidenceThreshold || 95;
                        document.getElementById('aiConfidence').textContent = `${confidenceThreshold}%`;
                        
                        // Update accuracy threshold from settings
                        const accuracyThreshold = data.settings.accuracyThreshold || 88;
                        document.getElementById('minAccuracy').textContent = `${accuracyThreshold}%`;
                        
                        // Update auto execute from settings
                        const autoExecute = data.settings.autoExecute || false;
                        document.getElementById('autoExecute').checked = autoExecute;
                    }
                })
                .catch(error => {
                    console.error('Failed to load extended settings:', error);
                });
        }
        
        // Update trading signals grid
        function updateTradingSignals(signals) {
            const grid = document.getElementById('signalsGrid');
            
            if (!signals || signals.length === 0) {
                grid.innerHTML = `
                    <div class="text-center py-12 text-gray-500 col-span-3">
                        <i class="fas fa-brain text-6xl mb-4 opacity-20"></i>
                        <p>No active trading signals</p>
                        <p class="text-sm">AI is analyzing market conditions...</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = signals.slice(0, 6).map(signal => `
                <div class="glass-card rounded-xl p-6 hover:scale-105 transition-all duration-300">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-lg font-bold text-white">${signal.symbol}</h4>
                        <span class="text-sm px-3 py-1 rounded-full ${signal.side === 'Buy' ? 'bg-green-900/50 text-green-400' : 'bg-red-900/50 text-red-400'}">
                            ${signal.side}
                        </span>
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-400">Confidence:</span>
                            <span class="text-neon-yellow font-bold">${signal.confidence}%</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Take Profit:</span>
                            <span class="text-neon-green">${signal.take_profit}%</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Stop Loss:</span>
                            <span class="text-neon-pink">${signal.stop_loss}%</span>
                        </div>
                        <button class="w-full cyber-button py-2 px-4 rounded-lg text-sm mt-4" 
                                onclick="executeSignal('${signal.symbol}', '${signal.side}', ${signal.take_profit}, ${signal.stop_loss})">
                            <i class="fas fa-rocket mr-2"></i>EXECUTE
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        // Execute signal
        function executeSignal(symbol, side, takeProfit, stopLoss) {
            if (confirm(`Execute ${side} signal for ${symbol}?`)) {
                fetch('/api/execute_ai_trade', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        symbol: symbol,
                        side: side,
                        amount: 100,
                        takeProfit: takeProfit,
                        stopLoss: stopLoss
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        addConsoleMessage('SUCCESS', `Trade executed: ${symbol} ${side}`);
                        updateDashboard();
                    } else {
                        addConsoleMessage('ERROR', `Trade failed: ${data.message}`);
                    }
                })
                .catch(error => {
                    addConsoleMessage('ERROR', `Error: ${error.message}`);
                });
            }
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            initCharts();
            updateDashboard();
            updateTradingStatus();
            updateROIChart('1h');
            
            // Set up refresh intervals
            setInterval(updateDashboard, 10000);  // Every 10 seconds
            setInterval(updateTradingStatus, 15000);  // Every 15 seconds
            
            // Add initial console message
            addConsoleMessage('SUCCESS', 'A.R.I.E Control Center initialized');
            addConsoleMessage('INFO', 'Loading real-time data...');
            
            // Initial data load
            setTimeout(() => {
                addConsoleMessage('SUCCESS', 'Real-time data connection established');
            }, 2000);
        });
        
        // Position management
        function closePosition(symbol, side, size) {
            if (confirm(`Close position for ${symbol}?`)) {
                fetch('/api/close_position', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        symbol: symbol,
                        side: side,
                        size: size
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        addConsoleMessage('SUCCESS', `Position closed: ${symbol}`);
                        updateDashboard();
                    } else {
                        addConsoleMessage('ERROR', `Failed to close position: ${data.error || data.message}`);
                    }
                });
            }
        }
        
        function closeAllPositions() {
            if (confirm('Close ALL positions?')) {
                fetch('/api/close_all_positions', { method: 'POST' })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            const closedCount = data.closed_positions ? data.closed_positions.length : 0;
                            addConsoleMessage('SUCCESS', `All positions closed (${closedCount} positions)`);
                            if (data.errors && data.errors.length > 0) {
                                data.errors.forEach(error => addConsoleMessage('WARNING', error));
                            }
                            updateDashboard();
                        } else {
                            addConsoleMessage('ERROR', `Failed to close positions: ${data.error}`);
                            if (data.errors && data.errors.length > 0) {
                                data.errors.forEach(error => addConsoleMessage('ERROR', error));
                            }
                        }
                    })
                    .catch(error => {
                        addConsoleMessage('ERROR', `Error closing positions: ${error}`);
                    });
            }
        }
        
        // Table sorting functions
        function sortTable(column) {
            // If clicking the same column, toggle direction
            if (sortColumn === column) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                // New column, default to ascending
                sortColumn = column;
                sortDirection = 'asc';
            }
            
            // Update sort icons
            updateSortIcons(column, sortDirection);
            
            // Re-render table with sorted data
            updatePositionsTable(currentPositions);
        }
        
        function sortPositions(positions, column, direction) {
            if (!positions || positions.length === 0) {
                return positions;
            }
            
            const sortedPositions = [...positions];
            
            sortedPositions.sort((a, b) => {
                let aVal, bVal;
                
                switch(column) {
                    case 'symbol':
                        aVal = a.symbol || '';
                        bVal = b.symbol || '';
                        break;
                    case 'side':
                        aVal = a.side || '';
                        bVal = b.side || '';
                        break;
                    case 'size':
                        aVal = parseFloat(a.size || 0);
                        bVal = parseFloat(b.size || 0);
                        break;
                    case 'entry':
                        aVal = parseFloat(a.avgPrice || 0);
                        bVal = parseFloat(b.avgPrice || 0);
                        break;
                    case 'current':
                        aVal = parseFloat(a.markPrice || 0);
                        bVal = parseFloat(b.markPrice || 0);
                        break;
                    case 'pnl':
                        aVal = parseFloat(a.unrealisedPnl || 0);
                        bVal = parseFloat(b.unrealisedPnl || 0);
                        break;
                    case 'roi':
                        aVal = parseFloat(a.percentage || 0);
                        bVal = parseFloat(b.percentage || 0);
                        break;
                    case 'leverage':
                        aVal = parseFloat(a.leverage || 1);
                        bVal = parseFloat(b.leverage || 1);
                        break;
                    case 'im':
                        aVal = parseFloat(a.positionIM || 0);
                        bVal = parseFloat(b.positionIM || 0);
                        break;
                    case 'mm':
                        aVal = parseFloat(a.positionMM || 0);
                        bVal = parseFloat(b.positionMM || 0);
                        break;
                    case 'tp1':
                        aVal = getTPDistance(a.tp_levels, 1);
                        bVal = getTPDistance(b.tp_levels, 1);
                        break;
                    case 'tp2':
                        aVal = getTPDistance(a.tp_levels, 2);
                        bVal = getTPDistance(b.tp_levels, 2);
                        break;
                    case 'tp3':
                        aVal = getTPDistance(a.tp_levels, 3);
                        bVal = getTPDistance(b.tp_levels, 3);
                        break;
                    case 'tp4':
                        aVal = getTPDistance(a.tp_levels, 4);
                        bVal = getTPDistance(b.tp_levels, 4);
                        break;
                    case 'stop_loss':
                        aVal = parseFloat(a.stop_loss?.price || a.stop_loss || 0);
                        bVal = parseFloat(b.stop_loss?.price || b.stop_loss || 0);
                        break;
                    case 'sl_breakeven':
                        aVal = a.sl_moved_to_breakeven ? 1 : 0;
                        bVal = b.sl_moved_to_breakeven ? 1 : 0;
                        break;
                    default:
                        return 0;
                }
                
                // Handle string vs number comparison
                if (typeof aVal === 'string' && typeof bVal === 'string') {
                    const result = direction === 'asc' ? aVal.localeCompare(bVal) : bVal.localeCompare(aVal);
                    return result;
                } else {
                    // Handle NaN values
                    if (isNaN(aVal)) aVal = 0;
                    if (isNaN(bVal)) bVal = 0;
                    
                    const result = direction === 'asc' ? aVal - bVal : bVal - aVal;
                    return result;
                }
            });
            
            return sortedPositions;
        }
        
        function updateSortIcons(activeColumn, direction) {
            // Reset all sort icons
            const columns = ['symbol', 'side', 'size', 'entry', 'current', 'pnl', 'roi', 'leverage', 'im', 'mm', 'tp1', 'tp2', 'tp3', 'tp4', 'stop_loss', 'sl_breakeven'];
            columns.forEach(col => {
                const icon = document.getElementById(`sort-icon-${col}`);
                if (icon) {
                    icon.className = 'fas fa-sort ml-1 text-xs';
                }
            });
            
            // Update active column icon
            const activeIcon = document.getElementById(`sort-icon-${activeColumn}`);
            if (activeIcon) {
                if (direction === 'asc') {
                    activeIcon.className = 'fas fa-sort-up ml-1 text-xs text-neon-cyan';
                } else {
                    activeIcon.className = 'fas fa-sort-down ml-1 text-xs text-neon-cyan';
                }
            }
        }
    </script>
</body>
</html>